{"remainingRequest":"/Users/ht.mi/个人资料/研究生资料/个人论文/tree_visual_query/RETree-main-sumbit/FrontEnd/node_modules/babel-loader/lib/index.js!/Users/ht.mi/个人资料/研究生资料/个人论文/tree_visual_query/RETree-main-sumbit/FrontEnd/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/ht.mi/个人资料/研究生资料/个人论文/tree_visual_query/RETree-main-sumbit/FrontEnd/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/ht.mi/个人资料/研究生资料/个人论文/tree_visual_query/RETree-main-sumbit/FrontEnd/src/components/SliceDiceTreemap.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/ht.mi/个人资料/研究生资料/个人论文/tree_visual_query/RETree-main-sumbit/FrontEnd/src/components/SliceDiceTreemap.vue","mtime":1648714649000},{"path":"/Users/ht.mi/个人资料/研究生资料/个人论文/tree_visual_query/RETree-main-sumbit/FrontEnd/node_modules/cache-loader/dist/cjs.js","mtime":1660192275271},{"path":"/Users/ht.mi/个人资料/研究生资料/个人论文/tree_visual_query/RETree-main-sumbit/FrontEnd/node_modules/babel-loader/lib/index.js","mtime":1660192275351},{"path":"/Users/ht.mi/个人资料/研究生资料/个人论文/tree_visual_query/RETree-main-sumbit/FrontEnd/node_modules/cache-loader/dist/cjs.js","mtime":1660192275271},{"path":"/Users/ht.mi/个人资料/研究生资料/个人论文/tree_visual_query/RETree-main-sumbit/FrontEnd/node_modules/vue-loader/lib/index.js","mtime":1660192275522}],"contextDependencies":[],"result":["import \"core-js/modules/es7.object.get-own-property-descriptors\";\nimport \"core-js/modules/es6.regexp.to-string\";\nimport _toConsumableArray from \"/Users/ht.mi/\\u4E2A\\u4EBA\\u8D44\\u6599/\\u7814\\u7A76\\u751F\\u8D44\\u6599/\\u4E2A\\u4EBA\\u8BBA\\u6587/tree_visual_query/RETree-main-sumbit/FrontEnd/node_modules/@babel/runtime-corejs2/helpers/esm/toConsumableArray\";\nimport \"core-js/modules/es6.regexp.split\";\nimport \"core-js/modules/es6.array.sort\";\nimport \"core-js/modules/web.dom.iterable\";\nimport \"core-js/modules/es6.object.keys\";\nimport \"core-js/modules/es6.function.name\";\nimport _defineProperty from \"/Users/ht.mi/\\u4E2A\\u4EBA\\u8D44\\u6599/\\u7814\\u7A76\\u751F\\u8D44\\u6599/\\u4E2A\\u4EBA\\u8BBA\\u6587/tree_visual_query/RETree-main-sumbit/FrontEnd/node_modules/@babel/runtime-corejs2/helpers/esm/defineProperty\";\nimport \"core-js/modules/es6.number.constructor\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(source, true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(source).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\n//\n//\n//\n//\n//\n//\nimport { mapState, mapMutations } from 'vuex';\nimport golbalVariable from \"../global\";\nimport recursive from \"../recursive\";\nexport default {\n  name: 'Tree',\n  props: {\n    msg: String,\n    width: Number,\n    height: Number,\n    jsonpath: String,\n    jsondata: Object,\n    random_highlight: Object\n  },\n  watch: {\n    width: function width() {\n      this.draw_slice_and_dice_treemap(this.jsonpath, this.jsondata, this.width, this.height, 0);\n    },\n    height: function height() {\n      this.draw_slice_and_dice_treemap(this.jsonpath, this.jsondata, this.width, this.height, 0);\n    },\n    treeViewState: function treeViewState() {\n      this.draw_slice_and_dice_treemap(this.jsonpath, this.jsondata, this.width, this.height, 0);\n    }\n  },\n  computed: _objectSpread({}, mapState(['displayMode', 'treeViewState'])),\n  data: function data() {\n    return {\n      counter: 0,\n      scale: 400\n    };\n  },\n  mounted: function mounted() {\n    this.draw_slice_and_dice_treemap(this.jsonpath, this.jsondata, this.width, this.height, 0);\n  },\n  methods: {\n    draw_slice_and_dice_treemap: function draw_slice_and_dice_treemap(jsonpath, jsondata, width, height) {\n      var needlable = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : false;\n      d3.select('#slice_and_dice_treemap').selectAll('*').remove();\n      var data = JSON.parse(JSON.stringify(jsondata));\n      data = this.recursive(data);\n      var keep_random_highlight = [];\n\n      if (this.random_highlight != null) {\n        var namelist = d3.hierarchy(data).descendants().map(function (d) {\n          return d.data.name;\n        });\n\n        if (golbalVariable.highlight_2leaves) {\n          namelist = d3.hierarchy(data).leaves().map(function (d) {\n            return d.data.name;\n          });\n        }\n\n        for (var k = 0; k < Object.keys(this.random_highlight).length; k++) {\n          var randomValue = this.random_highlight[Object.keys(this.random_highlight)[k]];\n          keep_random_highlight.push(\".\" + namelist[Math.floor(randomValue * (namelist.length - 1))] + \"sdt\");\n        }\n      } // console.log(keep_random_highlight)\n      // d3.json(jsonpath)\n      //   .then( (data) =>{\n\n\n      var min_width_height = Math.min(width, height);\n      var padding_r = min_width_height * (1 + min_width_height / this.scale) / this.scale; // let font_size_r = (min_width_height * 10) / this.scale;\n\n      var text_x_r = min_width_height * 19 / this.scale;\n      var trbl = min_width_height * 20 / this.scale;\n      var margin = {\n        top: trbl,\n        right: trbl,\n        bottom: trbl,\n        left: trbl\n      };\n      var innerWidth = width - margin.left;\n      var innerHeight = height - margin.top;\n      var root = d3.treemap().tile(d3.treemapSliceDice).size([innerWidth, innerHeight]).paddingInner(padding_r).paddingTop(padding_r).paddingRight(padding_r).paddingBottom(padding_r).paddingLeft(padding_r).round(true)(d3.hierarchy(data).eachBefore(function (d) {\n        d.data.id = (d.parent ? d.parent.data.id + '.' : '') + d.data.name;\n      }).sum(function (d) {\n        return d.value;\n      }).sort(function (a, b) {\n        return b.value - a.value;\n      }));\n\n      var group = function group(d) {\n        return d.id.split(\".\")[1];\n      };\n\n      var label = function label(d, n) {\n        return [].concat(_toConsumableArray(d.name.split(/(?=[A-Z][a-z])/g)), [n.value.toLocaleString(\"en\")]).join(\"\\n\");\n      };\n\n      var title = function title(d, n) {\n        return \"PATH: \".concat(d.id, \"\\nNAME:\").concat(d.name, \"\\nVALUE: \").concat(n.value.toLocaleString(\"en\"));\n      };\n\n      var DimGray = d3.rgb(105, 105, 105);\n      var LightGray = d3.rgb(211, 211, 211);\n      var G = root.leaves().map(function (d) {\n        return group(d.data, d);\n      });\n      var fill = '#ccc';\n      var zDomain = G;\n      zDomain = new d3.set(zDomain);\n      var color = d3.scaleOrdinal(zDomain, [DimGray, LightGray]);\n      var fillOpacity = 0.9;\n      var L = root.leaves().map(function (d) {\n        return label(d.data, d);\n      });\n      var T = root.leaves().map(function (d) {\n        return title(d.data, d);\n      });\n      var svg = d3.select(this.$el).select('#slice_and_dice_treemap').attr(\"style\", \"max-width: 100%; height: auto; height: intrinsic;\").attr(\"font-family\", \"sans-serif\");\n      var g = svg.append('g').attr('transform', \"translate(\".concat(margin.left / 2, \", \").concat(margin.top / 2, \")\"));\n      g.append('style').text(\"\\n            .rect-sdt-active {\\n              stroke: steelblue !important;\\n              stroke-opacity: 1;\\n              stroke-width: 1.5px;\\n            }\\n            .highlight-sdt-active {\\n              stroke: steelblue;\\n              stroke-opacity: 1;\\n              stroke-width: 1.5px;\\n            }\\n          \");\n      var node = g.selectAll('a').data(root.leaves()).join('a').attr('transform', function (d) {\n        return \"translate(\".concat(d.x0, \",\").concat(d.y0, \")\");\n      });\n      node.append('rect').attr('class', function (d) {\n        return d.data.name + 'sdt';\n      }).attr('fill', color ? function (d, i) {\n        return color(G[i]);\n      } : fill).attr('fill-opacity', fillOpacity).attr('width', function (d) {\n        return d.x1 - d.x0;\n      }).attr('height', function (d) {\n        return d.y1 - d.y0;\n      }).on(\"mouseover\", mouseovered(true, keep_random_highlight)).on(\"mouseout\", mouseovered(false, keep_random_highlight));\n\n      if (T) {\n        node.append('title').text(function (d, i) {\n          return T[i];\n        });\n      }\n\n      if (L && needlable) {\n        var uid = \"O-\".concat(Math.random().toString(16).slice(2));\n        node.append(\"clipPath\").attr(\"id\", function (d, i) {\n          return \"\".concat(uid, \"-clip-\").concat(i);\n        }).append(\"rect\").attr(\"width\", function (d) {\n          return d.x1 - d.x0;\n        }).attr(\"height\", function (d) {\n          return d.y1 - d.y0;\n        });\n        node.append(\"text\").attr(\"clip-path\", function (d, i) {\n          return \"url(\".concat(new URL(\"#\".concat(uid, \"-clip-\").concat(i), location), \")\");\n        }).selectAll(\"tspan\").data(function (d, i) {\n          return \"\".concat(L[i]).split(/\\n/g);\n        }).join(\"tspan\").attr(\"x\", text_x_r).attr(\"y\", function (d, i, D) {\n          return \"\".concat((i === D.length - 1) * 0.3 + 1.1 + i * 0.9, \"em\");\n        }).attr(\"fill-opacity\", function (d, i, D) {\n          return i === D.length - 1 ? 0.7 : null;\n        }).text(function (d) {\n          return d;\n        });\n      }\n\n      function mouseovered(active, keep_random_highlight) {\n        for (var _k = 0; _k < keep_random_highlight.length; _k++) {\n          d3.select(keep_random_highlight[_k]).classed(\"highlight-sdt-active\", true);\n        }\n\n        return function (d, i) {\n          d3.select(this).classed(\"rect-sdt-active\", active);\n        };\n      } // });\n\n    }\n  }\n};",{"version":3,"sources":["SliceDiceTreemap.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <div class=\"canvas\">\n    <svg id=\"slice_and_dice_treemap\" :width=\"width\" :height=\"height\"></svg>\n  </div>\n</template>\n\n<script>\nimport { mapState, mapMutations } from 'vuex';\nimport golbalVariable from '../global'\nimport recursive from '../recursive'\nexport default {\n\n  name: 'Tree',\n  props: {\n    msg: String,\n    width: Number,\n    height: Number,\n    jsonpath: String,\n    jsondata: Object,\n    random_highlight: Object,\n  },\n  watch: {\n      width: function() {\n        this.draw_slice_and_dice_treemap(this.jsonpath, this.jsondata, this.width, this.height, 0);\n      },\n      height: function() {\n        this.draw_slice_and_dice_treemap(this.jsonpath, this.jsondata, this.width, this.height, 0);\n      },\n      treeViewState: function() {\n        this.draw_slice_and_dice_treemap(this.jsonpath, this.jsondata, this.width, this.height, 0);\n      }\n  },\n  computed: {\n    ...mapState([\n        'displayMode',\n        'treeViewState'\n      ])\n  },\n  data(){\n    return{\n      counter: 0,\n      scale: 400,\n    }\n  },\n  mounted() {\n    this.draw_slice_and_dice_treemap(this.jsonpath, this.jsondata, this.width, this.height, 0);\n  },\n  methods:{\n    draw_slice_and_dice_treemap: function(jsonpath, jsondata, width, height, needlable=false) {\n\n      d3.select('#slice_and_dice_treemap').selectAll('*').remove();\n\n      let data = JSON.parse(JSON.stringify(jsondata))\n\n      data = this.recursive(data)\n\n      let keep_random_highlight = []\n      if(this.random_highlight != null){\n        let namelist = d3.hierarchy(data).descendants().map(d=>d.data.name)\n        if(golbalVariable.highlight_2leaves){namelist = d3.hierarchy(data).leaves().map(d=>d.data.name)}\n        for(let k=0;k<Object.keys(this.random_highlight).length;k++)\n        {\n          let randomValue = this.random_highlight[Object.keys(this.random_highlight)[k]]\n          keep_random_highlight.push(\".\"+namelist[Math.floor(randomValue * (namelist.length - 1))]+\"sdt\")\n        }\n      }\n      // console.log(keep_random_highlight)\n\n      // d3.json(jsonpath)\n      //   .then( (data) =>{\n\n          let min_width_height = Math.min(width, height);\n\n          let padding_r = (min_width_height *(1+min_width_height/this.scale)) / this.scale;\n          // let font_size_r = (min_width_height * 10) / this.scale;\n          let text_x_r = (min_width_height * 19) / this.scale;\n\n\n          let trbl = (min_width_height * 20) / this.scale;\n          let margin = { top: trbl, right: trbl, bottom: trbl, left: trbl };\n          let innerWidth = width - margin.left;\n          let innerHeight = height - margin.top;\n\n          let root = d3.treemap()\n            .tile(d3.treemapSliceDice)\n            .size([innerWidth, innerHeight])\n            .paddingInner(padding_r)\n            .paddingTop(padding_r)\n            .paddingRight(padding_r)\n            .paddingBottom(padding_r)\n            .paddingLeft(padding_r)\n            .round(true) (\n              d3.hierarchy(data)\n                .eachBefore(function(d){\n                  d.data.id = (d.parent? d.parent.data.id+'.':'')+d.data.name;\n                })\n                .sum( d=> d.value )\n                .sort((a,b) => b.value - a.value)\n            );\n\n          let group = function(d){return d.id.split(\".\")[1]; };\n          let label = function(d,n){return [...d.name.split(/(?=[A-Z][a-z])/g), n.value.toLocaleString(\"en\")].join(\"\\n\"); };\n          let title = function(d,n){return `PATH: ${d.id}\\nNAME:${d.name}\\nVALUE: ${n.value.toLocaleString(\"en\")}`; };\n          \n          let DimGray = d3.rgb(105,105,105)\n          let LightGray = d3.rgb(211,211,211)\n          \n          let G = root.leaves().map(d=>group(d.data, d));\n          let fill = '#ccc';\n          let zDomain = G;\n          zDomain = new d3.set(zDomain);\n          let color = d3.scaleOrdinal(zDomain, [DimGray,LightGray]);\n          let fillOpacity = 0.9;\n          let L = root.leaves().map(d=>label(d.data, d));\n          let T = root.leaves().map(d=>title(d.data, d));\n\n          const svg = d3.select(this.$el)\n            .select('#slice_and_dice_treemap')\n            .attr(\"style\", \"max-width: 100%; height: auto; height: intrinsic;\")\n            .attr(\"font-family\", \"sans-serif\")\n\n          const g = svg.append('g')\n            .attr('transform', `translate(${margin.left/2}, ${margin.top/2})`);\n\n          g.append('style').text(`\n            .rect-sdt-active {\n              stroke: steelblue !important;\n              stroke-opacity: 1;\n              stroke-width: 1.5px;\n            }\n            .highlight-sdt-active {\n              stroke: steelblue;\n              stroke-opacity: 1;\n              stroke-width: 1.5px;\n            }\n          `);\n\n          let node = g.selectAll('a')\n            .data(root.leaves())\n            .join('a')\n              .attr('transform', d=>`translate(${d.x0},${d.y0})`)\n\n          node.append('rect')\n            .attr('class',d=>d.data.name+'sdt')\n            .attr('fill', color ? (d,i)=>color(G[i]) : fill )\n            .attr('fill-opacity', fillOpacity)\n            .attr('width', d=>d.x1 - d.x0)\n            .attr('height', d=>d.y1 - d.y0)\n            .on(\"mouseover\", mouseovered(true,keep_random_highlight))\n            .on(\"mouseout\", mouseovered(false,keep_random_highlight));\n\n          if(T){node.append('title').text((d,i)=>T[i]); }\n\n          if(L && needlable){\n            let uid = `O-${Math.random().toString(16).slice(2)}`;\n\n            node.append(\"clipPath\")\n              .attr(\"id\", (d, i) => `${uid}-clip-${i}`)\n            .append(\"rect\")\n              .attr(\"width\", d => d.x1 - d.x0)\n              .attr(\"height\", d => d.y1 - d.y0);\n\n            node.append(\"text\")\n              .attr(\"clip-path\", (d, i) => `url(${new URL(`#${uid}-clip-${i}`, location)})`)\n            .selectAll(\"tspan\")\n            .data((d, i) => `${L[i]}`.split(/\\n/g))\n            .join(\"tspan\")\n              .attr(\"x\", text_x_r)\n              .attr(\"y\", (d, i, D) => `${(i === D.length - 1) * 0.3 + 1.1 + i * 0.9}em`)\n              .attr(\"fill-opacity\", (d, i, D) => i === D.length - 1 ? 0.7 : null)\n              .text(d => d);   \n          }\n\n          function mouseovered(active,keep_random_highlight){\n            for(let k=0;k<keep_random_highlight.length;k++){\n              d3.select(keep_random_highlight[k]).classed(\"highlight-sdt-active\", true);\n            }\n            return function(d, i){\n              d3.select(this).classed(\"rect-sdt-active\", active);\n            }\n          }\n\n\n      // });\n\n    }\n  }\n}\n</script>"],"sourceRoot":"src/components"}]}